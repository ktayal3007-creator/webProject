# Task: Implement Public Item History and Automatic Cleanup

## Plan
- [x] Step 1: Database Schema Updates (Completed)
  - [x] Add history_type column to lost_items and found_items tables
  - [x] Add concluded_at timestamp column (already existed)
  - [x] Create indexes for performance
  - [x] Update existing concluded items with proper history_type
- [x] Step 2: Create Database Functions (Completed)
  - [x] Create function to handle "Owner Found" conclusion (MAIN_HISTORY)
  - [x] Create function to handle other conclusions (USER_HISTORY)
  - [x] Create function for auto-cleanup (6 months old items)
  - [x] Create function for manual user history deletion
- [x] Step 3: Update RLS Policies (Completed)
  - [x] MAIN_HISTORY items readable by all authenticated users
  - [x] USER_HISTORY items readable only by reporter
  - [x] Prevent manual deletion of MAIN_HISTORY items
- [ ] Step 4: Create Scheduled Cleanup
  - [ ] Create Edge Function for daily cleanup task
  - [ ] Configure to run daily via cron
  - [ ] Delete items where concluded_at < (now - 6 months)
- [ ] Step 5: Update TypeScript Types
  - [ ] Add history_type enum
  - [ ] Add concluded_at field
  - [ ] Update item interfaces
- [ ] Step 6: Update API Functions
  - [ ] Update concludeItem to use new logic
  - [ ] Create getMainHistory function
  - [ ] Create getUserHistory function
  - [ ] Create deleteUserHistoryItem function
- [ ] Step 7: Create Main History UI
  - [ ] Create MainHistory page component
  - [ ] Display all MAIN_HISTORY items (public)
  - [ ] Show item details with "Owner Found" badge
- [ ] Step 8: Update User History UI
  - [ ] Update existing history page
  - [ ] Show only USER_HISTORY items
  - [ ] Add delete button for user's own items
- [ ] Step 9: Update Navigation
  - [ ] Add "Success Stories" or "Main History" link
  - [ ] Update routes
- [ ] Step 10: Testing and Validation
  - [ ] Test "Owner Found" → MAIN_HISTORY flow
  - [ ] Test other conclusions → USER_HISTORY flow
  - [ ] Test auto-cleanup logic
  - [ ] Test manual deletion
  - [ ] Run lint

## Notes
- CRITICAL: "Owner Found" MUST create MAIN_HISTORY (public)
- CRITICAL: Other conclusions MUST create USER_HISTORY (private)
- CRITICAL: Auto-delete after 6 months based on concluded_at
- CRITICAL: Users cannot delete MAIN_HISTORY items
- CRITICAL: All state changes must be atomic/transactional
